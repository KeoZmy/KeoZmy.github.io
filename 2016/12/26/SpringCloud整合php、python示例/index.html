
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SpringCloud整合php、python示例 | Keo&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="代码已上传至： https://github.com/KeoZmy/SpringCloudDemo.git ，博客中没有写到网关 zuul，但是git中已上传
##前言
最近一直在花时间研究微服务，各种开源组件组合一个framework到最后决定用springcloud这样成熟的framework。不得不说，springcloud确实很强大，还有Pivotal和Netfix是其强大的后盾与技术输出">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud整合php、python示例">
<meta property="og:url" content="http://KeoZmy.github.io/2016/12/26/SpringCloud整合php、python示例/index.html">
<meta property="og:site_name" content="Keo's Blog">
<meta property="og:description" content="代码已上传至： https://github.com/KeoZmy/SpringCloudDemo.git ，博客中没有写到网关 zuul，但是git中已上传
##前言
最近一直在花时间研究微服务，各种开源组件组合一个framework到最后决定用springcloud这样成熟的framework。不得不说，springcloud确实很强大，还有Pivotal和Netfix是其强大的后盾与技术输出">
<meta property="og:image" content="http://i.imgur.com/ilU73lu.png">
<meta property="og:image" content="http://i.imgur.com/q7K3c0r.png">
<meta property="og:image" content="http://i.imgur.com/Yjjg950.png">
<meta property="og:image" content="http://i.imgur.com/DvXPVAp.png">
<meta property="og:image" content="http://i.imgur.com/zOdmLvY.png">
<meta property="og:image" content="http://i.imgur.com/iGPSWqQ.png">
<meta property="og:updated_time" content="2016-12-26T08:01:53.880Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringCloud整合php、python示例">
<meta name="twitter:description" content="代码已上传至： https://github.com/KeoZmy/SpringCloudDemo.git ，博客中没有写到网关 zuul，但是git中已上传
##前言
最近一直在花时间研究微服务，各种开源组件组合一个framework到最后决定用springcloud这样成熟的framework。不得不说，springcloud确实很强大，还有Pivotal和Netfix是其强大的后盾与技术输出">
<meta name="twitter:image" content="http://i.imgur.com/ilU73lu.png">
  
    <link rel="alternative" href="/atom.xml" title="Keo&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Keo&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">温故而知新，每次阅读都会有新的收获</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="KeoZmy.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-SpringCloud整合php、python示例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/26/SpringCloud整合php、python示例/" class="article-date">
  <time datetime="2016-12-26T07:46:17.000Z" itemprop="datePublished">2016-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SpringCloud整合php、python示例
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>代码已上传至： <a href="https://github.com/KeoZmy/SpringCloudDemo.git" target="_blank" rel="external">https://github.com/KeoZmy/SpringCloudDemo.git</a> ，博客中没有写到网关 zuul，但是git中已上传</p>
<p>##前言</p>
<p>最近一直在花时间研究微服务，各种开源组件组合一个framework到最后决定用springcloud这样成熟的framework。不得不说，springcloud确实很强大，还有Pivotal和Netfix是其强大的后盾与技术输出。最后还是选用了springcloud的netfix作为核心的开发。</p>
<p>springcloud中的sidecar是出于netfix中prana的启发，正如官方reference所说：</p>
<p>Do you have non-jvm languages you want to take advantage of Eureka, Ribbon and Config Server? The Spring Cloud Netflix Sidecar was inspired by Netflix Prana. It includes a simple http api to get all of the instances (ie host and port) for a given service. You can also proxy service calls through an embedded Zuul proxy which gets its route entries from Eureka. The Spring Cloud Config Server can be accessed directly via host lookup or through the Zuul Proxy. The non-jvm app should implement a health check so the Sidecar can report to eureka if the app is up or down</p>
<p>你是否有非jvm语言应用程序需要使用Eureka, Ribbon和Config Server的功能? Spring Cloud Netflix Sidecar 受 Netflix Prana 启发. 它包含一个简单的HTTP API去获取所有注册的实例信息(包括host和port信息). 你也可以通过依赖Eureka的嵌入式Zuul代理器代理服务调用. The Spring Cloud Config Server可以通过host查找 或Zuul代理直接进入. 非JVM应用程序提供健康检查实现即可让Sidecar向eureka同步应用程序up还是down.</p>
<p>简单的说，一个非jvm程序，如：php、python等，想要注册到eureka，但是应用都是一堆别的语言写的，那我应该如何实现呢？Sidecar的原理就是侦听该应用所运行的端口，然后检测该程序的运行状态，官方的描述会更形象一些：</p>
<p><img src="http://i.imgur.com/ilU73lu.png" alt=""></p>
<p>##实现</p>
<p>本文主要是参考官方给出结合python的例子，示例了一个springcloud结合php、python的例子。</p>
<p>###php准备</p>
<p>先准备一下php的环境，详见：</p>
<p><a href="http://jingyan.baidu.com/article/cd4c2979f4797e756e6e6086.html" target="_blank" rel="external">使用WAMP快速搭建PHP Web开发环境</a></p>
<p>(ps:我没有做过php的相关开发，只是最近参与公司项目的重构，里面以java代码为主但是也有python、php的模块，自己快速搭建了一个php的demo做测试，如果你是专业的php developer你当然可以选择你自己的方式)</p>
<p>我的wamp服务器www目录：</p>
<p><img src="http://i.imgur.com/q7K3c0r.png" alt=""></p>
<p>health.json就是非JVM应用程序提供模仿SpringBoot健康检查接口的可访问的uri. 它应该返回一个json文档类似如下:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">by the way，我把服务器的端口改成了3000，默认的是80</div><div class="line"></div><div class="line">[如何修改wamp默认80端口](http://jingyan.baidu.com/article/e3c78d644100e83c4c85f5d7.html)</div><div class="line"></div><div class="line"></div><div class="line">###python准备（python大神请随意）</div><div class="line"></div><div class="line">这边主要是写了一个python程序模拟web应用的运行，这个应用占用的端口为5680</div></pre></td></tr></table></figure>

import httplib

from twisted.web import server, resource
from twisted.internet import reactor, endpoints

class Health(resource.Resource):
    isLeaf = True

    def render_GET(self, request):
        request.setHeader(&quot;content-type&quot;, &quot;application/json&quot;)
        return &apos;{&quot;status&quot;:&quot;UP&quot;}\n&apos;

class Fortune(resource.Resource):
    isLeaf = True

def render_GET(self, request):
    conn = httplib.HTTPConnection(&apos;localhost&apos;, 5678)
    conn.request(&quot;GET&quot;, &quot;/fortunes&quot;)
    res = conn.getresponse()
    fortune = res.read()
    request.setHeader(&quot;content-type&quot;, &quot;text/plain&quot;)
    return fortune


root = resource.Resource()
root.putChild(&apos;health&apos;, Health())    
root.putChild(&apos;&apos;, Fortune())
endpoints.serverFromString(reactor, &quot;tcp:5680&quot;).listen(server.Site(root))
reactor.run()
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###Eureka</div><div class="line"></div><div class="line">创建一个springboot程序，修改pom文件如下：</div></pre></td></tr></table></figure>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;groupId&gt;org.test&lt;/groupId&gt;
&lt;artifactId&gt;eureka&lt;/artifactId&gt;
&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;name&gt;eureka&lt;/name&gt;
&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.2.5.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;

&lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;Angel.SR3&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
 &lt;/project&gt;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">修改application.properties配置文件</div></pre></td></tr></table></figure>
<pre><code>server.port=8761
eureka.client.fetch-registry=false
eureka.client.register-with-eureka=false
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">最后，我们在EurekaApplication中添加注解`@EnableEurekaServer`，开启服务的注册中心</div><div class="line"></div><div class="line">![](http://i.imgur.com/h3H7XIB.png)</div><div class="line"></div><div class="line"></div><div class="line">项目目录结构如下：</div><div class="line"></div><div class="line">![](http://i.imgur.com/tWIMLjS.png)</div><div class="line"></div><div class="line">###Configserver</div><div class="line"></div><div class="line">创建一个springboot程序，修改pom文件如下：</div></pre></td></tr></table></figure>
<pre><code> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;groupId&gt;org.test&lt;/groupId&gt;
&lt;artifactId&gt;configserver&lt;/artifactId&gt;
&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;name&gt;configserver&lt;/name&gt;
&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.2.5.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;

&lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;
        &lt;exclusions&gt;
            &lt;exclusion&gt;
                &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
                &lt;artifactId&gt;spring-security-rsa&lt;/artifactId&gt;
            &lt;/exclusion&gt;
        &lt;/exclusions&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;Angel.SR3&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
 &lt;/project&gt;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">修改application.properties配置文件:</div></pre></td></tr></table></figure>
<pre><code>server.port=8888
spring.cloud.config.server.git.uri=https://github.com/spencergibb/oscon-config-repo
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这里还有一个配置文件bootstrap.properties：</div></pre></td></tr></table></figure>
<pre><code>server.port=5678
sidecar.port=3000
sidecar.health-uri=http://localhost:${sidecar.port}/phpTest/health.json
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">项目目录如下：</div><div class="line"></div><div class="line">![](http://i.imgur.com/Hblz6iN.png)</div><div class="line"></div><div class="line">###sidecar for php</div><div class="line"></div><div class="line">开始编写一个为php应用对接的sidecar程序</div><div class="line"></div><div class="line">同样，这是一个springboot程序，我们先改写pom.xml文件</div></pre></td></tr></table></figure>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;groupId&gt;org.test&lt;/groupId&gt;
&lt;artifactId&gt;sidecar&lt;/artifactId&gt;
&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;name&gt;sidecar&lt;/name&gt;
&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.2.5.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;

&lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-netflix-sidecar&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;
        &lt;version&gt;RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;Angel.SR3&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
&lt;/project&gt;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">然后在程序中开启@EnableSidecar</div><div class="line"></div><div class="line">![](http://i.imgur.com/ovJJGFH.png)</div><div class="line"></div><div class="line">最后，关键性的一步，我们改写application.properties文件</div></pre></td></tr></table></figure>
<pre><code>server.port=5678    
sidecar.port=3000
sidecar.health-uri=http://localhost:${sidecar.port}/phpTest/health.json
</code></pre><p><code>`` </code>server.port=5678` 指定了这个sidecar运行时所占用的端口</p>
<p> <code>sidecar.port=3000</code> 指定了sidecar监听非jvm应用程序的端口，就是我们的php程序所挂载的服务器，之前我已经把服务器端口改成3000了</p>
<p> <code>sidecar.health-uri=http://localhost:${sidecar.port}/phpTest/health.json</code>指定了php程序返回给sidecar的健康指标状态，我这里是通过文件的返回，当然你也可以通过RESTAPI，如果程序没有正常挂起，sidecar自然不能进行健康监测访问health.json（或者health方法），拿不到<code>up</code>，所以在注册中心则会显示一个<code>douwn</code>的状态，表示程序没有正常挂起，这就是sidecar的思想。</p>
<p>项目结构：</p>
<p><img src="http://i.imgur.com/Yjjg950.png" alt=""></p>
<p>###sidecar for python</p>
<p>创建一个为python对接的sidecar，步骤和上面创建为php的如出一辙，只是配置文件有些许的不同</p>
<pre><code>server.port=5688
sidecar.port=5680
sidecar.health-uri=http://localhost:${sidecar.port}/health
</code></pre><p>开头我们所准备的python应用占用的就是5680端口，这里拿到健康状态的监测是通过RESTAPI</p>
<p>###运行程序</p>
<p>只要php服务和python服务的开启在两个sidecar开启之前就好</p>
<p>JAVA程序的启动顺序为（从左到右）：</p>
<p><img src="http://i.imgur.com/DvXPVAp.png" alt=""></p>
<p>我们访问<code>http://localhost:8761/</code>可以看到：</p>
<p><img src="http://i.imgur.com/zOdmLvY.png" alt=""></p>
<p>两个非jvm语言的程序应用已经成功注册到eureka，并且是up的状态</p>
<p>我们关闭其中的一个python服务，可以看到：</p>
<p><img src="http://i.imgur.com/iGPSWqQ.png" alt=""></p>
<p>php和python服务已经如同springboot程序一样，关闭即down，可以在注册中心看到它的运行状态了！</p>
<p>##总结</p>
<p>SideCar的设计很优雅，它完全不会去入侵其他应用的代码。就像一个代理一样，它始终观察着应用的运行（它的健康状态），本质上注册到eureka的是sidecar，但是它所显示的状态却是它所监测的应用。只要php、python..等为其提供一个health监测的接口即可！</p>
<p>代码已上传至： <a href="https://github.com/KeoZmy/SpringCloudDemo.git" target="_blank" rel="external">https://github.com/KeoZmy/SpringCloudDemo.git</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://KeoZmy.github.io/2016/12/26/SpringCloud整合php、python示例/" data-id="cix5td7f90000y0u53zme17iw" class="article-share-link" data-share="baidu" data-title="SpringCloud整合php、python示例">Share</a>
      

      
        <a href="http://KeoZmy.github.io/2016/12/26/SpringCloud整合php、python示例/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/26/neo4j学习笔记（一）/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Neo4j学习笔记（一）初识Neo4j
        
      </div>
    </a>
  
  
    <a href="/2016/12/26/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2016/12/26/SpringCloud整合php、python示例/" data-title="SpringCloud整合php、python示例" data-url="http://KeoZmy.github.io/2016/12/26/SpringCloud整合php、python示例/"></div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/26/neo4j学习笔记（一）/">Neo4j学习笔记（一）初识Neo4j</a>
          </li>
        
          <li>
            <a href="/2016/12/26/SpringCloud整合php、python示例/">SpringCloud整合php、python示例</a>
          </li>
        
          <li>
            <a href="/2016/12/26/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://arvinxiang.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://yuancheng.work" target="_blank">远程.work</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 KeoZhao<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
