<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Keo&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="spring docker java">
<meta property="og:type" content="website">
<meta property="og:title" content="Keo's Blog">
<meta property="og:url" content="http://KeoZmy.github.io/index.html">
<meta property="og:site_name" content="Keo's Blog">
<meta property="og:description" content="spring docker java">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Keo's Blog">
<meta name="twitter:description" content="spring docker java">
  
    <link rel="alternate" href="/atom.xml" title="Keo&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Keo&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">温故而知新，每次阅读都会有新的收获</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://KeoZmy.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Windows环境下SpringBoot+Docker打包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/26/Windows环境下SpringBoot+Docker打包/" class="article-date">
  <time datetime="2016-12-26T07:44:40.943Z" itemprop="datePublished">2016-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#Windows环境下Spring Boot+Docker构建应用</p>
<p>##前言<br>最近在研究SpringCloud+Docker构建微服务化的架构，之前没有接触过Docker，在学习的过程中遇到了不少的问题，花了一天的时间学习了Docker，花了一天的时间学习SpringCloud，总算有了一点点的进展。本文将一步步带你构建一个基于 Spring Boot 和 Docker 的单体应用，但愿共同学习共同进步。</p>
<p>###SpringBoot简介<br>Spring Boot 是 Spring 社区发布的一个开源项目，旨在帮助开发者快速简单的构建可独立运行的项目。Spring Boot 会选择最适合的 Spring 子项目和第三方开源库进行整合。大部分 Spring Boot 应用只需要非常少的配置就可以快速运行起来。<br>Spring Boot是SpringCloud的基础，cloud是在boot之上的，所以要完成一个微服务的搭建，你必须先完成SpringBoot+Docker的构建。</p>
<p>官网地址：<a href="http://projects.spring.io/spring-boot/" target="_blank" rel="external">http://projects.spring.io/spring-boot/</a></p>
<p>###Docker简介<br>Docker 是一套以容器技术为核心的，用于应用的构建、分发和执行的体系和生态。官网地址：</p>
<p>官网地址：<a href="https://docker.com" target="_blank" rel="external">https://docker.com</a><br>ps：我的博客里整理一些docker的学习资料，但是经过一些弯路，还是强烈建议大家去看官网的doc文档，虽然是英文的，但是不难懂，而且很详细。</p>
<p>##环境搭建</p>
<ul>
<li><p>操作系统：64位，系统不限（需支持Docker，我这里是Win10），Windows 上建议安装 Git 客户端，方便支持 Linux 命令行操作</p>
</li>
<li><p>JDK 1.8 + ：推荐一款 Java 环境管理工具 jenv</p>
</li>
<li><p>Maven 3.0 + ：我这里用的是阿里的 Maven 仓库</p>
</li>
<li><p>Docker</p>
<ul>
<li><p>Linux安装教程参考：<a href="https://docs.docker.com/engine/installation/linux/" target="_blank" rel="external">https://docs.docker.com/engine/installation/linux/</a></p>
</li>
<li><p>如果你使用的是Mac或Windows，官方已有原生应用支持，下载地址：<a href="https://docs.docker.com/" target="_blank" rel="external">https://docs.docker.com/</a></p>
</li>
</ul>
</li>
<li><p>一个你喜欢的编译器或IDE，推荐 Atom 或 Intellij IDEA，或者Sublime Text</p>
</li>
</ul>
<p>##步骤</p>
<p>###第一步：新建工程目录<br>因为是Windows系统，走了不少的弯路。Spring官方给出的docker整合示例，是在Linux环境下的。Linux环境是直接可以通过指令build打包的，但是Windows不行，得借助Docker Quickstart Terminal，也就是安装成功后桌面上的：</p>
<p><img src="http://i.imgur.com/QPPFADx.png" alt=""></p>
<p>于是我们打开终端Terminal，输入：mkdir spring-boot-docker</p>
<p><img src="http://i.imgur.com/p4l2uAJ.png" alt=""></p>
<p>创建了我们的项目。接着，在根目录下创建 pom.xml 文件<br>    <code>touch pom.xml</code></p>
<p>在当前目录下新建子目录：</p>
<p><code>mkdir -p src/main/java/com/keozhao/hello</code></p>
<p><img src="http://i.imgur.com/hGoZaGu.png" alt=""></p>
<p>一个典型的 Maven 项目结构如下：</p>
<p><img src="http://i.imgur.com/dqengtk.png" alt=""></p>
<p>###第二步:配置pom.xml文件<br>在 pom.xml 中添加内容如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;groupId&gt;bingohuang.com&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-docker-cloudcomb&lt;/artifactId&gt;
&lt;version&gt;0.1.0&lt;/version&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;
&lt;name&gt;Spring Boot + Docker + Cloudcomb&lt;/name&gt;
&lt;description&gt;一步步带你构建 Spring Boot + Docker 应用及网易蜂巢服务&lt;/description&gt;

&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.3.3.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt;
&lt;/parent&gt;

&lt;properties&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;


&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
    &lt;/project&gt;
</code></pre><p>以上 pom 文件并不复杂，是一个 Spring Boot 的标准配置，Spring Boot 的 Maven 插件会提供以下功能：</p>
<pre><code>1.收集的类路径上所有 jar 文件，并构建成一个单一的、可运行的 jar 文件，这使得它更方便地执行和传输服务。
2.搜索 public static void main() 方法来标记为可运行的类。
3.提供了一个内置的依赖解析器，用于设置版本号以匹配 Spring Boot 的依赖。你可以覆盖任何你想要的版本，但它会默认使用 Spring Boot 所设置的版本集。
</code></pre><p>操作示例：<br><img src="http://i.imgur.com/aqDI0Ly.png" alt=""></p>
<p>通过start指令，调用系统默认打开该文件的程序，你直接将上述代码写入即可</p>
<p>###第三步：编写SpringBoot应用程序</p>
<p>创建一个简单的 Java 应用程序:<br>    <code>touch src/main/java/com/keozhao/hello/Application.java</code></p>
<p>代码如下：</p>
<pre><code>  package com.keozhao.hello;

  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.web.bind.annotation.RequestMapping;
  import org.springframework.web.bind.annotation.RestController;

  /**
      * Sprint Boot 主应用入口
      * @author Keo.Zhao
      * @date 2016.12.10
  */
@SpringBootApplication
@RestController
public class Application {

@RequestMapping(&quot;/&quot;)
public String home() {
    return &quot;Hello Spring Boot, Docker and CloudComb!&quot;;
}


public static void main(String[] args) {
    SpringApplication.run(Application.class, args);
}
 } 
</code></pre><p>代码核心就是处理了根路径（/）的 web 请求，并包含可执行的 main 方法，比较好理解，解释一下其中几个关键点：</p>
<ul>
<li><p>用 @SpringBootApplication 和 @RestController 注解类, 表示可用 Spring MVC 来处理 Web 请求</p>
</li>
<li><p>@RequestMapping 将 / 映射到 home() 方法，并返回相应文本</p>
</li>
<li><p>main() 方法使用 Spring Boot 的 SpringApplication.run() 方法来启动应用</p>
</li>
</ul>
<p>操作示例：</p>
<p><img src="http://i.imgur.com/qS98xhE.png" alt=""></p>
<p>我这里默认打开是Sublime Text，于是从Sublime写入</p>
<p><img src="http://i.imgur.com/ABO1JOq.png" alt=""></p>
<p>###第四步：本地运行</p>
<p>####Maven构建<br>该应用的核心代码就已完成，也就两个文件，可见 Spring Boot 非常简单。在项目根目录执行：<code>mvn package</code></p>
<p><img src="http://i.imgur.com/91WNrGj.png" alt=""></p>
<p>之后会在根目录下生成一个 target 目录，并在 target 目录下包含一个可执行的 jar 包。</p>
<p>####运行jar包<br>Spring Boot 的强大之处是将应用打成一个可独立运行的 jar 文件：</p>
<p>   <code>java -jar target/spring-boot-docker-cloudcomb-0.1.0.jar</code></p>
<p>不出意外，输出日志，应用启动，默认会监听 8080 端口。</p>
<p><img src="http://i.imgur.com/c9yaGHH.png" alt=""></p>
<p><img src="http://i.imgur.com/hwYowsx.png" alt=""></p>
<p>####访问应用</p>
<p>应用正常启动后，浏览器访问 <a href="http://127.0.0.1:8080/，即可看到页面输出字样：" target="_blank" rel="external">http://127.0.0.1:8080/，即可看到页面输出字样：</a></p>
<p><img src="http://i.imgur.com/nLtEYva.png" alt=""></p>
<p>###第五步：容器化构建及运行</p>
<p>####书写DockerFile<br>在项目根目录下创建一个 Dockerfile 文件，<code>touch Dockerfile</code><br>内容如下：</p>
<pre><code>FROM frolvlad/alpine-oraclejdk8:slim

COPY target/spring-boot-docker-cloudcomb-0.1.0.jar app.jar

ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
</code></pre><p>此 Dockerfile 并不复杂，核心功能就是将可执行文件拷贝到镜像中，并在容器启动时默认执行启动命令 java -jar /app.jar<br>一样也是也通过start的指令打开，再写入、保存。</p>
<p>####docker 构建</p>
<p>在项目根目录下执行 docker 构建镜像命令：<br>    <code>docker build -t spring-boot-docker-cloudcomb:0.1.0 .</code><br>（别忘记后面的点）</p>
<p><a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="external">docker build 指令详情</a></p>
<p><img src="http://i.imgur.com/N7VoP8V.png" alt=""></p>
<p>这一步完成，你已经成功构建了镜像，输入<code>docker images</code>可以看见<br><img src="http://i.imgur.com/exCPbnD.png" alt=""></p>
<p>####docker运行<br>运行 docker 容器：<br>    <code>docker run -p 8080:8080 -t spring-boot-docker-cloudcomb:0.1.0</code></p>
<p>####访问项目<br>同样，会输出日志（略有不同），监听 8080 端口，浏览器访问 <a href="http://127.0.0.1:8080/（或者localhost:8080），输出文本。" target="_blank" rel="external">http://127.0.0.1:8080/（或者localhost:8080），输出文本。</a></p>
<p>Hello Spring Boot, Docker and CloudComb!</p>
<p>到这里，你已经成功完成了Windows环境下SpringBoot + Docker构建应用！！</p>
<p>###一点小发现：</p>
<p>如果你觉得在终端窗口一步步创建文件比较麻烦，或许我们可以直接把工程copy到Terminal的运行环境中。其实在上文，start打开应用时，我们可以发现文件创建在了<code>C:\Users\Keo.Zhao</code>这个路径下，Keo.Zhao是我的用户名，不同的电脑这里必然会有差异，不妨打开你的电脑看看这个路径。因为docker才学习了一天，其实一些细节、机制还不了解。但是我猜测，Terminal本质还是为Windows用户提供了一个虚拟的Linux环境，在Linux的环境里是没有盘符这个概念的，所以默认当前系统用户的目录为运行的目录（应该可以更改，后期再研究，有不对的地方希望大牛能指出，多谢！）。所以，可以直接把你在ide里写好的项目，copy到<code>C:\Users\Keo.Zhao</code>目录下，你的也许会叫做<code>C:\Users\administrator</code>，打开Terminal，输入<code>dir</code>，一定会有新的发现~</p>
<p>本文参考链接：</p>
<p><a href="https://github.com/163yun/spring-boot-docker-cloudcomb" target="_blank" rel="external">https://github.com/163yun/spring-boot-docker-cloudcomb</a></p>
<p><a href="https://docs.docker.com/" target="_blank" rel="external">https://docs.docker.com/</a></p>
<p><a href="https://spring.io/guides/gs/spring-boot-docker/#initial" target="_blank" rel="external">https://spring.io/guides/gs/spring-boot-docker/#initial</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://KeoZmy.github.io/2016/12/26/Windows环境下SpringBoot+Docker打包/" data-id="cix5s3fbl0001wou5z4phiuea" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud整合php、python示例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/26/SpringCloud整合php、python示例/" class="article-date">
  <time datetime="2016-12-26T07:42:58.000Z" itemprop="datePublished">2016-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/26/SpringCloud整合php、python示例/">SpringCloud整合php、python示例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://KeoZmy.github.io/2016/12/26/SpringCloud整合php、python示例/" data-id="cix5s3fat0000wou521u446ye" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/26/Windows环境下SpringBoot+Docker打包/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/12/26/SpringCloud整合php、python示例/">SpringCloud整合php、python示例</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 KeoZhao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>